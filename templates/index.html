<div id="chatbar">
<input id="text" placeholder="Ask me anything...">
<button id="sendBtn">â¤</button>
<button id="micBtn">ğŸ¤</button>
<button id="attachBtn">ğŸ“</button>
<input type="file" id="fileInput" style="display:none" />
</div>
<div id="messages"></div>


<script>
let isRecording = false, mediaRecorder, pendingFiles = [];


// Send message
function sendMessage(){
if(!text.value.trim() && pendingFiles.length===0) return;
const formData = new FormData();
formData.append("message", text.value);
pendingFiles.forEach(f=>formData.append("files",f));
fetch("/chat", { method:"POST", body: formData })
.then(r=>r.json()).then(d=>addMessage(d.reply,"assistant"));
text.value=""; pendingFiles=[];
}


// Enter = send
text.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); sendMessage(); }});


// Mic toggle
micBtn.onclick = async ()=>{
if(!isRecording){
const stream = await navigator.mediaDevices.getUserMedia({audio:true});
mediaRecorder = new MediaRecorder(stream);
mediaRecorder.start();
micBtn.textContent="â¹"; isRecording=true;
} else {
mediaRecorder.stop();
micBtn.textContent="ğŸ¤"; isRecording=false;
}
};


// Attach button
attachBtn.onclick = ()=> fileInput.click();
fileInput.onchange = ()=>{
[...fileInput.files].forEach(file=>{
pendingFiles.push(file);
let preview=document.createElement("div");
preview.textContent=file.name+" âŒ";
preview.onclick=()=>{ pendingFiles=pendingFiles.filter(f=>f!==file); preview.remove(); };
messages.appendChild(preview);
});
};
</script>
```
